###  mysql批量插入一千万数据

#####  1.创建一张表

``` sql
CREATE TABLE dept(
id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
deptno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,
dname VARCHAR(20) NOT NULL DEFAULT "",
loc VARCHAR(13) NOT NULL DEFAULT ""
) ENGINE=INNODB DEFAULT CHARSET=GBK ;
```

```sql
CREATE TABLE emp (
	id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
	empno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,
	ename VARCHAR (20) NOT NULL DEFAULT "",
	job VARCHAR (9) NOT NULL DEFAULT "",
	mgr MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,
	hiredate DATE NOT NULL,
	sal DECIMAL (7, 2) NOT NULL,
	comm DECIMAL (7, 2) NOT NULL,
	deptno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0
) ENGINE = INNODB DEFAULT CHARSET = GBK;
```



#####  2.设置参数log_bin_trust_function_creators

​     创建函数，假如报错: This function has none of DETERMINST......
#由于开启过慢查询日志，因为我们开启了bin-log, 我们就必须为我们的function指定一一个参数。

```sql
show variables like 'log_ bin_ trust_ function_ creators';

set global log_ bin_ trust_ function_ creators=1;
```

  #这样添加了参数以后，如果mysqld重启J上述参数又会消失，永久方法:
windows下my.ini[mysqld]加上.log_ bin_ _trust_ function_ creators=1
linux下/etc/my.cnf 下my cnfmysqld]加上Elog_ bin_ _trust_ function_ _creators=1

#####  3.创建函数，保证每条数据都不同

- 随机产生字符串

  ```sql
  DELIMITER $$
  CREATE FUNCTION rand_string(n INT) RETURNS VARCHAR(255)
  BEGIN
  DECLARE chars_str VARCHAR (100) DEFAULT 'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ';
  DECLARE return_str VARCHAR(255) DEFAULT '';
  DECLARE i INT DEFAULT 0;
  WHILE i < n DO
  SET return_str = CONCAT(return_str, SUBSTRING (chars_str,FLOOR(1+RAND()*52),1));
  SET i = i + 1;
  END WHILE;
  RETURN return_str;
  END $$
  ```

- 随机产生部门编号

  ```sql
  DELIMITER $$
  CREATE FUNCTION rand_num() RETURNS INT(5)
  BEGIN
  DECLARE i INT DEFAULT 0;
  SET i= FLOOR(100+RAND()*10);
  RETURN i;
  END $$
  ```


#####  4.创建存储过程

- 往员工表中插入数据的存储过程

  ```sql
  DELIMITER $$
  CREATE PROCEDURE insert_emp(IN START INT(10),IN max_num INT(10))
  BEGIN
  DECLARE i INT DEFAULT 0;
  #set autocommit =0把autocommit设 置成0
  SET autocommit = 0;
  REPEAT
  SET i= i+1;
  INSERT INTO emp (empno,ename,job,mgr,hiredate,sal,comm,deptno) VALUES ((START+i)
  ,rand_string(6),'SALESMAN' ,0001,CURDATE(),2000,400,rand_num());
  UNTIL i = max_num
  END REPEAT;
  COMMIT ;
  END $$
  
  ```

- 往部门表中插入数据的存储过程

  ```sql
  DELIMITER $$
  CREATE PROCEDURE insert_dept(IN START INT(10),IN max_num INT(10))
  BEGIN
  DECLARE i INT DEFAULT 0;
  SET autocommit = 0;
  REPEAT
  SET i=i+ 1;
  INSERT INTO dept(deptno ,dname,loc) VALUES ((START+i),rand_string(10),rand_string(8));
  UNTIL i = max_num
  END REPEAT;
  COMMIT;
  END $$
  ```


#####  5.调用存储过程

```sql
DELIMITER;
CALL insert_dept(100,10); 
```

```sql
DELIMITER;
CALL insert_emp(100001,500000);
```





